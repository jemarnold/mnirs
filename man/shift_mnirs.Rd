% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/shift_mnirs.R
\name{shift_mnirs}
\alias{shift_mnirs}
\title{Shift data range}
\usage{
shift_mnirs(
  data,
  nirs_channels = list(),
  time_channel = NULL,
  to = NULL,
  by = NULL,
  width = NULL,
  span = NULL,
  position = c("min", "max", "first"),
  inform = TRUE
)
}
\arguments{
\item{data}{A data frame of class \emph{"mnirs"} containing at least one
column with numeric time or sample values, and one column with numeric
mNIRS values, along with metadata.}

\item{nirs_channels}{A \code{list()} of character vectors indicating the column
names for data channels to be shifted (see \emph{Details}).
\describe{
\item{\code{list("A", "B", "C")}}{Will shift each channel independently,
losing the relative scaling between channels.}
\item{\code{list(c("A", "B", "C"))}}{Will shift all channels together,
preserving the relative scaling between channels.}
\item{\code{list(c("A", "B"), c("C", "D"))}}{Will shift channels \code{A} and \code{B}
in one group, and channels \code{C} and \code{D} in another group, preserving
relative scaling within, but not between groups.}
}
Must match column names in data exactly. Will be taken from metadata if
not defined explicitly.}

\item{time_channel}{A character string indicating the time or sample channel
name. Must match column names in \code{data} exactly. Will be taken from
metadata if not defined explicitly.}

\item{to}{A numeric value in units of \code{nirs_channels} to which the data
channels will be shifted, e.g. shift the minimum value to zero.}

\item{by}{A numeric value in units of \code{nirs_channels} by which the data
channels will be shifted, e.g. shift all values up by 10 units.}

\item{width}{An integer defining the local window in number of samples
around \code{idx} in which to perform the operation., between
\verb{[idx - floor(width/2), idx + floor(width/2)]}.}

\item{span}{A numeric value defining the local window timespan around \code{idx}
in which to perform the operation. In units of \code{time_channel} or \code{t},
between \verb{[t - span/2, t + span/2]}.}

\item{position}{Indicates where the reference values will be shifted from.
\describe{
\item{\code{"min"}}{(The \emph{default}) will shift the minimum value(s) \code{to}
or \code{by} the specified value.}
\item{\code{"max"}}{Will shift the maximum value(s) \code{to} or \code{by} the
specified values.}
\item{\code{"first"}}{Will shift first value(s) \code{to} or \code{by} the specified
values.}
}}

\item{inform}{A logical to display (the \emph{default}) or \code{FALSE} to silence
warnings and information messages used for troubleshooting.}
}
\value{
A \link[tibble:tibble-package]{tibble} of class \emph{"mnirs"} with metadata
available with \code{attributes()}.
}
\description{
Move the range of data channels in a data frame up or down, while preserving
the absolute amplitude/dynamic range of each channel, and the relative
scaling across channels. e.g. shift the minimum data value to zero for all
positive values, or shift the mean of the first time span in a recording
to zero.
}
\details{
\code{nirs_channels = list()} can be used to group data channels to preserve
absolute or relative scaling.
\itemize{
\item Channels grouped together in a list item will be shifted to a common
value, and the relative scaling within that group will be preserved.
\item Channels grouped in separate list items will be shifted independently,
and relative scaling between groups will be lost.
\item Channels (columns) in \code{data} not explicitly defined in \code{nirs_channels}
will be passed through untouched to the output data frame.
}

\code{nirs_channels} and \code{time_channel} can be retrieved automatically from
\code{data} of class \emph{"mnirs"} which has been processed with \code{{mnirs}},
if not defined explicitly. This will default to returning all
\code{nirs_channels} grouped together, and should be defined explicitly
for other grouping arrangements.

Only one of either \code{to} or \code{by} and one of either \code{width} or \code{span} should
be defined. If both of either pairing are defined, \code{to} will be preferred
over \code{by}, and \code{width} will be preferred over \code{span}.
}
\examples{
\dontshow{if ((identical(Sys.getenv("NOT_CRAN"), "true") || identical(Sys.getenv("IN_PKGDOWN"), "true"))) withAutoprint(\{ # examplesIf}
library(ggplot2)

## read example data
data_shifted <- read_mnirs(
    file_path = example_mnirs("moxy_ramp"),
    nirs_channels = c(smo2 = "SmO2 Live"),
    time_channel = c(time = "hh:mm:ss"),
    inform = FALSE
) |>
    resample_mnirs(inform = FALSE) |>
    replace_mnirs(
        invalid_values = c(0, 100),
        outlier_cutoff = 3,
        width = 10,
        inform = FALSE
    ) |>
    filter_mnirs(na.rm = TRUE, inform = FALSE) |>
    shift_mnirs(
        to = 0,             ## NIRS values will be shifted to zero
        span = 120,         ## shift the first 120 sec of data to zero
        position = "first",
        inform = FALSE
    )

plot(data_shifted, label_time = TRUE) +
    geom_hline(yintercept = 0, linetype = "dotted")
\dontshow{\}) # examplesIf}
}
