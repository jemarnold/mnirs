% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/helpers.R
\name{compute_local_windows}
\alias{compute_local_windows}
\alias{compute_local_fun}
\alias{compute_outliers}
\alias{compute_window_of_valid_neighbours}
\title{Computes vectorised rolling local values}
\usage{
compute_local_windows(
  t,
  idx = seq_along(t),
  width = NULL,
  span = NULL,
  verbose = TRUE
)

compute_local_fun(x, window_idx, fn)

compute_outliers(x, window_idx, local_medians, outlier_cutoff)

compute_window_of_valid_neighbours(
  x,
  t = seq_along(x),
  width = NULL,
  span = NULL,
  verbose = TRUE
)
}
\arguments{
\item{t}{An \emph{optional} numeric vector of time or sample number.}

\item{idx}{A numeric vector of indices of \code{t} at which to calculate local
windows. All indices of \code{t} by \emph{default}, or can be used to only calculate
for known indicies, such as invalid values of \code{x}.}

\item{width}{An integer defining the local window in number of samples
around \code{idx} in which to perform the operation., between
\verb{[idx - floor(width/2), idx + floor(width/2)]}.}

\item{span}{A numeric value defining the local window timespan around \code{idx}
in which to perform the operation. In units of \code{time_channel} or \code{t},
between \verb{[t - span/2, t + span/2]}.}

\item{verbose}{A logical to display (the \emph{default}) or \code{FALSE} to silence
warnings and information messages used for troubleshooting.}

\item{x}{A numeric vector.}

\item{window_idx}{A list the same length as \code{window_idx} and the same or
shorter length as \code{x} with numeric vectors for the sample indices of
local rolling windows.}

\item{fn}{A function to pass through for local rolling calculation.
Currently used functions are \code{c(median, mean)}.}

\item{local_medians}{A numeric vector the same length as \code{x} of local
median values.}

\item{outlier_cutoff}{An integer for the local outlier threshold, as
number of standard deviations above and below the local median. The
\emph{default} \code{outlier_cutoff = NULL} will not replace outliers.
\code{outlier_cutoff = 3} is the standard replacement threshold following
Pearson's rule.}
}
\value{
\code{compute_local_windows()}: A list the same length as \code{idx} and the same or
shorter length as \code{t} with numeric vectors of sample indices of length
\code{width} samples or \code{span} units of time \code{t}.

\code{compute_local_fun()}: A numeric vector the same length as \code{x}.

\code{compute_outliers()}: A logical vector the same length as \code{x}.

\code{compute_window_of_valid_neighbours()}: A list the same length as \code{NA}
values in \code{x} with numeric vectors of sample indices of length
\code{width} samples or \code{span} units of time \code{t} for valid values neighbouring
split to either side of the invalid \code{NA}s.
}
\description{
\code{compute_local_windows()}: Helper function to return a list of rolling
sample indices \code{idx} along a time variable \code{t}, defined by either \code{width}
in samples or \code{span} in units of \code{t}.

\code{compute_local_fun()}: Helper function to return a vector of local values
calculated from \code{x} by a function \code{fn} within a list of rolling sample
windows.

\code{compute_outliers()}: Helper function to return a vector of logicals
indicating local outliers of \code{x} within a list of rolling sample windows
\code{window_idx}.

\code{compute_window_of_valid_neighbours()}: Helper function to return a list of
sample indices \code{idx} along valid values of \code{x} to either side of \code{NA}s,
defined by either \code{width} in samples or \code{span} in units of \code{t}.
}
\details{
Local rolling calculations are made within a window defined by either
\code{width} as the number of samples centred on \code{idx} between
\verb{[idx - floor(width/2), idx + floor(width/2)]}, or \code{span} as the
timespan in units of \code{time_channel} centred on \code{idx} between
\verb{[t - span/2, t + span/2]}. A partial moving average will be calculated
at the edges of the data.
}
\examples{
x <- c(1, 2, 3, 100, 5)
t <- seq_along(x)

## a list of numeric vectors of rolling local windows along `t`
(window_idx <- mnirs:::compute_local_windows(t, width = 2, span = NULL))

## a numeric vector of local medians of `x`
(local_medians <- mnirs:::compute_local_fun(x, window_idx, median))

## a logical vector of local outliers of `x`
(is.outlier <- mnirs:::compute_outliers(x, window_idx, local_medians, outlier_cutoff = 3))

## a list of numeric vectors of local windows of valid values of `x` neighbouring `NA`s.
x <- c(1, 2, 3, NA, NA, 6)
(window_idx <- mnirs:::compute_window_of_valid_neighbours(x, width = 2))

(local_medians <- mnirs:::compute_local_fun(x, window_idx, median))

x[is.na(x)] <- local_medians
x

}
\keyword{internal}
